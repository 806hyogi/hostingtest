<!DOCTYPE html>
<html style="height:100%;">
<head>
<meta charset="UTF-8">
<title>KaKaoMap Study</title>
</head>
<body style="margin:0; padding:0; height:100%;">
    <div id="map" style="width:100%;height:100%;"></div>

    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=baa1f48d1a2ac62f865637b2ddb9ac08"></script>
    <script type="text/javascript">
        var container = document.getElementById('map'); //지도를 담을 영역의 DOM 레퍼런스
        var options = { //지도를 생성할 때 필요한 기본 옵션
            center: new kakao.maps.LatLng(33.450701, 126.570667), //지도의 중심좌표.
            level: 2 //지도의 레벨(확대, 축소 정도)
        };

        var map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴

        if (navigator.geolocation) { // Geolocation API 브라우저에서 지원되는지 확인
            // 현재 위치를 계속 추적하고 새로운 위치 정보가 사용가능할때마다 콜백 함수 호출
            navigator.geolocation.watchPosition(function(position) {
                var lat = position.coords.latitude, 
                    lon = position.coords.longitude;

                var locPosition = new kakao.maps.LatLng(lat, lon); // 새로운 위도 경도 좌표

                map.setCenter(locPosition); 

                var imageSize = new kakao.maps.Size(64, 69), 
                    imageOption = {offset: new kakao.maps.Point(27, 69)}; 

                // 마커 이미지 경로
                var markerImage = new kakao.maps.MarkerImage('./right.png', imageSize, imageOption),
                    markerPosition  = new kakao.maps.LatLng(lat, lon); 

                var marker = new kakao.maps.Marker({
                    position: markerPosition,
                    image : markerImage
                });

                // 마커를 지도에 추가
                marker.setMap(map);
            });

            // 디바이스 방향 변경을 감지하여 로그에 출력
            Window.addEventListener('deviceorientation', function(event){
                let alphaRad = event.alpha * (Math.PI / 180);
                let betaRad = event.beta * (Math.PI / 180);
                let gammaRad = event.gamma * (Math.PI / 180);

                let compassHeadingRad;
                if(betaRad > 0){
                    compassHeadingRad = Math.PI - Math.atan2(Math.tan(gammaRad), Math.cos(betaRad));

                }else{
                    compassHeadingRad = Math.atan2(Math.tan(gammaRad), Math.cos(betaRad));
                }

                let compassHeadingDeg = compassHeadingRad * (180 / Math.PI);

                console.log('Compass Heading:', compassHeadingDeg);
            });

        } else {
            console.log("Geolocation API가 지원하지 않습니다.");
        }
    </script>
</body>
</html>

